<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login-Etask</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9.15.2/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
    <script src="../public/node_modules/sweetalert/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="sweetalert2.min.css">
  

</head>
<body>          
          <div id="container">
         <form id="form_login" class="login">

            <input id="login" type="text" placeholder="Username">
            <input id="senha" type="password" placeholder="Password">

            <input id='one' type='checkbox' />
            <label for='one'>
              <span></span>
              Manter-me logado
              <ins><i>Manter-me logado</i></ins>
            </label>
             <a class="lista" href="../lost-password/lostPassword.html"><li class="lista" >Lost password?</li></a>
             <a class="lista" href="../cadastro/cadastro.html"><li class="lista">Não tem cadastro?</li></a>

            <button nclick="entrar()">Go to Dashboard!</button>
          </form>
         </div>
         </body>
         </html>

         <script>
          function entrar() {
      
              const Toast = Swal.mixin({
                  toast: true,
                  position: 'top-end',
                  showConfirmButton: false,
                  timer: 3000
              });
      
              if (nome_login.value == "" && senha_login.value != "") {
                  Toast.fire({
                      type: 'error',
                      title: 'Usuário não informado!'
                  });
              } else if (nome_login.value != "" && senha_login.value == "") {
                  Toast.fire({
                      type: 'error',
                      title: 'Senha não informada!'
                  });
              } else if (nome_login.value == "" && senha_login.value == "") {
                  Toast.fire({
                      type: 'error',
                      title: 'Usuário e Senha não informada!'
                  });
              } else {
      
                  var formulario = new URLSearchParams(new FormData(form_login));
      
                  Swal.fire({
                      title: 'Carregando...',
                      text: 'Estamos efetuando o seu Login!',
                      imageUrl: 'aguarde.gif',
                      imageAlt: 'Custom image',
                      showConfirmButton: false
                  })
                  fetch("../usuarios/autenticar", {
                      method: "POST",
                      body: formulario
                  }).then(function (response) {
      
                      if (response.ok) {
                          response.json().then(resposta => {
                              if (resposta == false) {
                                  Swal.fire('Erro no login', 'Tente novamente', 'error');
                              } else {
      
                                  if (resposta[0].email == undefined) {
                                      Toast.fire({
                                          type: 'success',
                                          title: 'Login efetuado com sucesso!'
                                      }).then(function () {
                                          console.log(JSON.stringify(resposta));
                                          sessionStorage.setItem('qtdemail', resposta.length);
                                          for (i = 0; i < resposta.length; i++) {
                                              sessionStorage.setItem(`email_${i + 1}`, JSON.stringify(resposta[i]));
                                          }
                                          sessionStorage.id = resposta[0].id;
                                          sessionStorage.usuario = resposta[0].nome;
                                          window.location.href = '../sistema-web/Dasboard.html';
                                      })
                                  }
                              }
      
                          });
                      } else {
      
                          Swal.fire('Erro no login', 'Tente novamente', 'error');
                      }
                  });
      
                  return false;
      
              }
          }
      </script>
        